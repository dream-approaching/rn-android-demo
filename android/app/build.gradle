apply plugin: 'com.android.application'
def dimensions_debug = "debug"
def dimensions_release = "release"

project.ext.react = [
        entryFile    : "index.js",
        bundleInDebug: true
]

apply from: "../../node_modules/react-native/react.gradle"
apply from: "../../node_modules/react-native-code-push/android/codepush.gradle"

def static releaseTime() {
    return new Date().format("yyyy-MM-dd", TimeZone.getTimeZone("UTC"))
}

def static getVersionCode(buildType) {
    if ('release' == buildType) {
        10000500//国内版
    } else {
        10000500//debug
    }
}

def static getVersionName(buildType) {
    if ('release' == buildType) {
        "1.0.05"//国内版
    } else {
        "1.0.05"//debug
    }
}

android {
    compileSdkVersion 28
    defaultConfig {
        applicationId "com.lieying.socialappstore"
        minSdkVersion rootProject.ext.minSdk
        targetSdkVersion rootProject.ext.targetSdk
        versionCode 10000500
        versionName "1.0.6"
        multiDexEnabled true
    }
    signingConfigs {
        debug {

        }
        relealse {
            storeFile file("Weiwang_browser_key.jks")
            storePassword "WWbrowser2016**"
            keyAlias "weiwang"
            keyPassword "WWbrowser2016**"
        }
    }
    buildTypes {
        debug {
            minifyEnabled false
            debuggable true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            buildConfigField("String", "UMENG_APP_KEY", "\"5c7e2b032036573c490017af\"")
            buildConfigField("String", "UMENG_SECRET", "\"1\"")
            buildConfigField("String", "WECHAT_APPKEY", "\"wxdc1e388c3822c80b\"")
            buildConfigField("String", "WECHAT_SECRET", "\"815bba5db8e2825432479294bd2a0f6b\"")
            buildConfigField("String", "QQ_APPKEY", "\"1.0.385877\"")
            buildConfigField("String", "QQ_SECRET", "\"1xCo8itrjmSXBBUT\"")
            buildConfigField("String", "SINA_APPKEY", "\"1789429604\"")
            buildConfigField("String", "SINA_SECRET", "\"4b46ec1f685c29229b43c3b9e826072f\"")
            buildConfigField("String", "MAIN_HOST", "\"http://192.168.0.200:1230\"")
//            buildConfigField("String", "MAIN_HOST", "\"http://192.168.0.200:8060\"")
            buildConfigField("String", "CODEPUSH_KEY", "\"\"")
            // buildConfigField ("String", "CODEPUSH_KEY", "\"o4iJo8DvOvPwZqmDoQ5LREDtjbLU020bac4f-d7e1-48e7-8584-7bdb6a68f649\"")
            // applicationIdSuffix ".debug"
        }

        releaseStaging {

            //混淆
            minifyEnabled false
            debuggable false
            shrinkResources false
            //Zipalign优化
            zipAlignEnabled true
            signingConfig signingConfigs.relealse
            matchingFallbacks = ['release', 'debug']
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            buildConfigField("String", "UMENG_APP_KEY", "\"5c7e2b032036573c490017af\"")
            buildConfigField("String", "UMENG_SECRET", "\"1\"")
            buildConfigField("String", "WECHAT_APPKEY", "\"wxdc1e388c3822c80b\"")
            buildConfigField("String", "WECHAT_SECRET", "\"815bba5db8e2825432479294bd2a0f6b\"")
            buildConfigField("String", "QQ_APPKEY", "\"1.0.385877\"")
            buildConfigField("String", "QQ_SECRET", "\"1xCo8itrjmSXBBUT\"")
            buildConfigField("String", "SINA_APPKEY", "\"1789429604\"")
            buildConfigField("String", "SINA_SECRET", "\"4b46ec1f685c29229b43c3b9e826072f\"")
//            buildConfigField("String", "MAIN_HOST", "\"http://192.168.0.200:8060\"")
            buildConfigField("String", "MAIN_HOST", "\"http://192.168.0.200:1530\"")
            buildConfigField("String", "CODEPUSH_KEY", "\"o4iJo8DvOvPwZqmDoQ5LREDtjbLU020bac4f-d7e1-48e7-8584-7bdb6a68f649\"")

        }

        release {
            //混淆
            minifyEnabled false
            debuggable false
            shrinkResources false
            //Zipalign优化
            zipAlignEnabled true
            signingConfig signingConfigs.relealse

            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            buildConfigField("String", "UMENG_APP_KEY", "\"5c7e2b032036573c490017af\"")
            buildConfigField("String", "UMENG_SECRET", "\"1\"")
            buildConfigField("String", "WECHAT_APPKEY", "\"wx50dc5d8f5df68ac5\"")
            buildConfigField("String", "WECHAT_SECRET", "\"815bba5db8e2825432479294bd2a0f6b\"")
            buildConfigField("String", "QQ_APPKEY", "\"1.0.385877\"")
            buildConfigField("String", "QQ_SECRET", "\"1xCo8itrjmSXBBUT\"")
            buildConfigField("String", "SINA_APPKEY", "\"1789429604\"")
            buildConfigField("String", "SINA_SECRET", "\"4b46ec1f685c29229b43c3b9e826072f\"")
            buildConfigField("String", "MAIN_HOST", "\"http://192.168.0.200:1230\"")
            buildConfigField("String", "CODEPUSH_KEY", "\"bmR48duSItRtLTvGmuYJ5Cz-BcGr020bac4f-d7e1-48e7-8584-7bdb6a68f649\"")
        }

//        pretest {
//            minifyEnabled true
//            debuggable false
//            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
//            buildConfigField("String", "MAIN_HOST", "\"http://192.168.0.130:8060\"")
//        }

    }

    flavorDimensions dimensions_release
    //渠道Flavors
    //批量打包命令：gradlew assembleRelease
    productFlavors {
        //友盟： UMENG_CHANNEL_VALUE
        CESHI {//测试
            dimension dimensions_release
            manifestPlaceholders = [UMENG_CHANNEL_VALUE: "999"]
        }
    }

    applicationVariants.all { variant ->
        variant.outputs.all {
            outputFileName = "xcs_V${getVersionName(variant.buildType.name)}_${releaseTime()}_${variant.productFlavors[0].name}.apk"
        }
    }
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

}

dependencies {
    implementation project(':react-native-spring-scrollview')
    implementation project(':react-native-code-push')
    implementation project(':react-native-gesture-handler')
    implementation project(':react-native-device-info')
    implementation fileTree(include: ['*.jar'], dir: 'libs')
    implementation "com.android.support:appcompat-v7:${rootProject.ext.support}"
    implementation "com.android.support:design:${rootProject.ext.support}"
    implementation 'com.android.support.constraint:constraint-layout:1.1.3'
    implementation "com.android.support:support-vector-drawable:${rootProject.ext.support}"
    implementation 'com.github.bumptech.glide:glide:4.9.0'
    implementation "com.android.support:support-v4:${rootProject.ext.support}"
    implementation "com.android.support:recyclerview-v7:${rootProject.ext.support}"
    implementation 'com.squareup.retrofit2:retrofit:2.5.0'
    implementation 'com.android.support:support-v4:28.0.0'
    implementation 'com.android.support:recyclerview-v7:28.0.0'
    testImplementation 'junit:junit:4.12'
    implementation 'com.google.code.gson:gson:2.8.5'
    implementation 'com.squareup.retrofit2:adapter-rxjava2:2.5.0'
    implementation 'com.squareup.okhttp3:okhttp-urlconnection:3.13.1'
    implementation 'org.jetbrains:annotations:15.0'
    implementation 'com.squareup.retrofit2:converter-gson:2.3.0'
    implementation 'com.google.zxing:core:3.3.0'

    implementation 'io.reactivex.rxjava2:rxjava:2.2.6'
    implementation 'io.reactivex.rxjava2:rxandroid:2.0.1'
    implementation "com.facebook.react:react-native:+"

    implementation 'com.gyf.immersionbar:immersionbar:3.0.0-beta01'
    implementation project(path: ':comlib')
    implementation 'com.android.support:multidex:1.0.3'
    implementation 'am.widget:smoothinputlayout:1.1.2'
    implementation project(path: ':photoalbumlibrary')
}
